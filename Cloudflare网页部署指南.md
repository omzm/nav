# Cloudflare ç½‘é¡µç«¯æ‰‹åŠ¨éƒ¨ç½²æŒ‡å— ğŸš€

> å…¨ç¨‹åœ¨æµè§ˆå™¨ä¸­æ“ä½œï¼Œæ— éœ€å‘½ä»¤è¡Œï¼

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

1. æ³¨å†Œ Cloudflare è´¦å·ï¼šhttps://dash.cloudflare.com/sign-up
2. ç™»å½•åˆ° Cloudflare Dashboardï¼šhttps://dash.cloudflare.com/

---

## ç¬¬ä¸€æ­¥ï¼šåˆ›å»º D1 æ•°æ®åº“ ğŸ’¾

### 1.1 åˆ›å»ºæ•°æ®åº“

1. ç™»å½• Cloudflare Dashboard
2. åœ¨å·¦ä¾§èœå•æ‰¾åˆ° **Workers & Pages**
3. ç‚¹å‡»é¡¶éƒ¨çš„ **D1 SQL Database** æ ‡ç­¾
4. ç‚¹å‡» **Create database** æŒ‰é’®
5. è¾“å…¥æ•°æ®åº“åç§°ï¼š`nav-database`
6. ç‚¹å‡» **Create** æŒ‰é’®

### 1.2 åˆå§‹åŒ–æ•°æ®åº“è¡¨

1. åˆ›å»ºæˆåŠŸåï¼Œç‚¹å‡»è¿›å…¥æ•°æ®åº“è¯¦æƒ…é¡µ
2. ç‚¹å‡» **Console** æ ‡ç­¾
3. **æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹ä¸­çš„ `cloudflare/schema.sql` æ–‡ä»¶**
4. **å¤åˆ¶è¯¥æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹**ï¼ˆåŒ…å«å®Œæ•´çš„è¡¨ç»“æ„å’Œç¤ºä¾‹æ•°æ®ï¼‰
5. ç²˜è´´åˆ° Cloudflare D1 æ§åˆ¶å°ä¸­
6. ç‚¹å‡» **Execute** æŒ‰é’®
7. çœ‹åˆ°æˆåŠŸæç¤ºåï¼Œç‚¹å‡» **Tables** æ ‡ç­¾ï¼Œç¡®è®¤æœ‰ä»¥ä¸‹ä¸‰ä¸ªè¡¨ï¼š
   - `categories`ï¼ˆåˆ†ç±»è¡¨ï¼‰
   - `sites`ï¼ˆç½‘ç«™è¡¨ï¼‰
   - `settings`ï¼ˆè®¾ç½®è¡¨ï¼‰

**æ³¨æ„**ï¼šé»˜è®¤ç®¡ç†å¯†ç æ˜¯ `admin123`ï¼Œéƒ¨ç½²å®Œæˆåè®°å¾—ä¿®æ”¹

### 1.3 è®°å½•æ•°æ®åº“ ID

1. åœ¨æ•°æ®åº“è¯¦æƒ…é¡µï¼Œæ‰¾åˆ° **Database ID**ï¼ˆæ ¼å¼ç±»ä¼¼ï¼š`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`ï¼‰
2. **å¤åˆ¶å¹¶ä¿å­˜è¿™ä¸ª ID**ï¼Œåé¢ä¼šç”¨åˆ°

---

## ç¬¬äºŒæ­¥ï¼šåˆ›å»º Workerï¼ˆAPI åç«¯ï¼‰âš™ï¸

### 2.1 åˆ›å»º Worker

1. å›åˆ° Cloudflare Dashboard
2. è¿›å…¥ **Workers & Pages**
3. ç‚¹å‡» **Create** æŒ‰é’®
4. é€‰æ‹© **Create Worker**
5. è¾“å…¥ Worker åç§°ï¼š`nav-api`ï¼ˆæˆ–ä»»æ„åç§°ï¼‰
6. ç‚¹å‡» **Deploy** æŒ‰é’®ï¼ˆå…ˆéƒ¨ç½²é»˜è®¤ä»£ç ï¼Œåé¢å†ä¿®æ”¹ï¼‰

### 2.2 ä¸Šä¼  Worker ä»£ç 

1. éƒ¨ç½²æˆåŠŸåï¼Œç‚¹å‡» **Edit code** æŒ‰é’®
2. åˆ é™¤é»˜è®¤ä»£ç ï¼Œå°† `cloudflare/src/index.js` çš„å…¨éƒ¨å†…å®¹ç²˜è´´è¿›å»
3. ç‚¹å‡»å³ä¸Šè§’ **Save and deploy** æŒ‰é’®

### 2.3 ç»‘å®š D1 æ•°æ®åº“

1. å›åˆ° Worker è¯¦æƒ…é¡µï¼Œç‚¹å‡» **Settings** æ ‡ç­¾
2. æ‰¾åˆ° **Bindings** åŒºåŸŸ
3. ç‚¹å‡» **Add binding** æŒ‰é’®
4. é€‰æ‹© **D1 database**
5. å¡«å†™ï¼š
   - **Variable name**: `DB`ï¼ˆå¿…é¡»æ˜¯å¤§å†™ DBï¼‰
   - **D1 database**: é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ `nav-database`
6. ç‚¹å‡» **Save** æŒ‰é’®

### 2.4 è®°å½• Worker URL

1. åœ¨ Worker è¯¦æƒ…é¡µé¡¶éƒ¨ï¼Œæ‰¾åˆ°ä½ çš„ Worker URL
2. æ ¼å¼ç±»ä¼¼ï¼š`https://nav-api.ä½ çš„ç”¨æˆ·å.workers.dev`
3. **å¤åˆ¶å¹¶ä¿å­˜è¿™ä¸ª URL**ï¼Œåé¢é…ç½®å‰ç«¯æ—¶ä¼šç”¨åˆ°

---

## ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å‰ç«¯é…ç½® ğŸ“

### 3.1 ä¿®æ”¹ API åœ°å€

1. ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ `nav.html` æ–‡ä»¶
2. æ‰¾åˆ°ç¬¬ 446 è¡Œå·¦å³çš„è¿™ä¸€è¡Œï¼š

```javascript
const API_BASE_URL = window.location.origin + '/api';
```

3. ä¿®æ”¹ä¸ºä½ çš„ Worker URLï¼ˆåŠ ä¸Š `/api`ï¼‰ï¼š

```javascript
const API_BASE_URL = 'https://nav-api.ä½ çš„ç”¨æˆ·å.workers.dev/api';
```

**ç¤ºä¾‹**ï¼š
```javascript
const API_BASE_URL = 'https://nav-api.abc123.workers.dev/api';
```

4. ä¿å­˜æ–‡ä»¶

---

## ç¬¬å››æ­¥ï¼šéƒ¨ç½²å‰ç«¯åˆ° Cloudflare Pages ğŸŒ

### æ–¹å¼ Aï¼šç›´æ¥ä¸Šä¼ ï¼ˆæœ€ç®€å•ï¼‰

1. åœ¨ Cloudflare Dashboard ä¸­ï¼Œè¿›å…¥ **Workers & Pages**
2. ç‚¹å‡» **Create** æŒ‰é’®
3. é€‰æ‹© **Pages** æ ‡ç­¾
4. ç‚¹å‡» **Upload assets** æŒ‰é’®
5. è¾“å…¥é¡¹ç›®åç§°ï¼š`my-nav`ï¼ˆæˆ–ä»»æ„åç§°ï¼‰
6. ç‚¹å‡» **Create project** æŒ‰é’®
7. å°†è¿™äº›æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ ï¼š
   - `nav.html`
   - `robots.txt`
   - `sitemap.xml`
8. ç‚¹å‡» **Deploy site** æŒ‰é’®

### æ–¹å¼ Bï¼šé€šè¿‡ GitHubï¼ˆæ¨èï¼Œæ–¹ä¾¿æ›´æ–°ï¼‰

#### B.1 ä¸Šä¼ ä»£ç åˆ° GitHub

1. åœ¨ GitHub åˆ›å»ºæ–°ä»“åº“ï¼šhttps://github.com/new
2. ä»“åº“åç§°ï¼š`my-navigation`ï¼ˆæˆ–ä»»æ„åç§°ï¼‰
3. è®¾ç½®ä¸º **Public**
4. ç‚¹å‡» **Create repository**
5. æŒ‰ç…§ GitHub æç¤ºä¸Šä¼ ä»£ç ï¼š

```bash
cd D:\tmp
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/ä»“åº“å.git
git push -u origin main
```

#### B.2 è¿æ¥ GitHub åˆ° Pages

1. åœ¨ Cloudflare Dashboard ä¸­ï¼Œè¿›å…¥ **Workers & Pages**
2. ç‚¹å‡» **Create** æŒ‰é’®
3. é€‰æ‹© **Pages** æ ‡ç­¾
4. ç‚¹å‡» **Connect to Git** æŒ‰é’®
5. æˆæƒ Cloudflare è®¿é—®ä½ çš„ GitHub
6. é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ä»“åº“
7. ç‚¹å‡» **Begin setup**
8. æ„å»ºè®¾ç½®ï¼š
   - **Build command**: ç•™ç©º
   - **Build output directory**: `/`
9. ç‚¹å‡» **Save and Deploy**

---

## ç¬¬äº”æ­¥ï¼šæµ‹è¯•éƒ¨ç½² âœ…

### 5.1 è·å–ç½‘ç«™åœ°å€

éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªåœ°å€ï¼Œç±»ä¼¼ï¼š
- `https://my-nav.pages.dev`

### 5.2 æµ‹è¯•åŠŸèƒ½

1. è®¿é—®ä½ çš„ç½‘ç«™åœ°å€
2. ç‚¹å‡»å³ä¸Šè§’çš„ **é½¿è½®å›¾æ ‡**ï¼ˆè®¾ç½®ï¼‰
3. è¾“å…¥å¯†ç ï¼š`admin123`ï¼ˆé»˜è®¤å¯†ç ï¼‰
4. å¼€å¯ç¼–è¾‘æ¨¡å¼
5. å°è¯•æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ç½‘ç«™
6. åˆ·æ–°é¡µé¢ï¼Œç¡®è®¤æ•°æ®å·²ä¿å­˜

### 5.3 ä¿®æ”¹é»˜è®¤å¯†ç 

1. åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»è®¾ç½®å›¾æ ‡
2. ç‚¹å‡» **ä¿®æ”¹å¯†ç **
3. è¾“å…¥æ—§å¯†ç ï¼š`admin123`
4. è¾“å…¥æ–°å¯†ç ï¼ˆä¸¤æ¬¡ï¼‰
5. ç‚¹å‡»ç¡®è®¤

---

## ğŸ¯ å®Œæˆï¼

ç°åœ¨ä½ çš„å¯¼èˆªç½‘ç«™å·²ç»éƒ¨ç½²æˆåŠŸï¼š

- ğŸŒ **å‰ç«¯åœ°å€**ï¼š`https://your-site.pages.dev`
- ğŸ”Œ **API åœ°å€**ï¼š`https://nav-api.xxx.workers.dev`
- ğŸ’¾ **æ•°æ®åº“**ï¼šCloudflare D1
- ğŸš€ **å…¨çƒ CDN** åŠ é€Ÿ
- ğŸ”’ **è‡ªåŠ¨ HTTPS**
- âœ… **å®Œå…¨å…è´¹**

---

## ğŸ“ åç»­ç»´æŠ¤

### æ›´æ–° Worker ä»£ç 

1. è¿›å…¥ Worker è¯¦æƒ…é¡µ
2. ç‚¹å‡» **Edit code**
3. ä¿®æ”¹ä»£ç 
4. ç‚¹å‡» **Save and deploy**

### æ›´æ–°å‰ç«¯

- **æ–¹å¼ A**ï¼ˆç›´æ¥ä¸Šä¼ ï¼‰ï¼šåœ¨ Pages é¡¹ç›®ä¸­ä¸Šä¼ æ–°æ–‡ä»¶
- **æ–¹å¼ B**ï¼ˆGitHubï¼‰ï¼šæ¨é€ä»£ç åˆ° GitHubï¼Œè‡ªåŠ¨éƒ¨ç½²

### ä¿®æ”¹ç½‘ç«™æ•°æ®

ä¸¤ç§æ–¹å¼ï¼š

1. **é€šè¿‡ç½‘é¡µ**ï¼šå¼€å¯ç¼–è¾‘æ¨¡å¼ï¼Œç›´æ¥æ·»åŠ /ç¼–è¾‘/åˆ é™¤
2. **é€šè¿‡æ•°æ®åº“**ï¼šåœ¨ D1 æ§åˆ¶å°æ‰§è¡Œ SQL å‘½ä»¤

### æŸ¥çœ‹æ•°æ®åº“

1. è¿›å…¥ D1 æ•°æ®åº“è¯¦æƒ…é¡µ
2. ç‚¹å‡» **Console** æ ‡ç­¾
3. æ‰§è¡Œ SQL æŸ¥è¯¢ï¼š

```sql
-- æŸ¥çœ‹æ‰€æœ‰ç½‘ç«™
SELECT * FROM sites;

-- æŸ¥çœ‹è®¾ç½®
SELECT * FROM settings;
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: API è¯·æ±‚å¤±è´¥

**æ£€æŸ¥**ï¼š
1. Worker URL æ˜¯å¦æ­£ç¡®é…ç½®åœ¨ `nav.html` ä¸­
2. D1 æ•°æ®åº“æ˜¯å¦æ­£ç¡®ç»‘å®šåˆ° Worker
3. æ•°æ®åº“è¡¨æ˜¯å¦æ­£ç¡®åˆ›å»º

### Q2: ç½‘ç«™æ— æ³•è®¿é—®

**æ£€æŸ¥**ï¼š
1. Pages éƒ¨ç½²çŠ¶æ€æ˜¯å¦æˆåŠŸ
2. æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¸Šä¼ 
3. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### Q3: ç¼–è¾‘æ¨¡å¼æ— æ³•ä¿å­˜

**æ£€æŸ¥**ï¼š
1. å¯†ç æ˜¯å¦æ­£ç¡®
2. API åœ°å€æ˜¯å¦é…ç½®æ­£ç¡®
3. Worker æ˜¯å¦æ­£å¸¸è¿è¡Œ

---

## ğŸ”— ç›¸å…³é“¾æ¥

- Cloudflare Dashboard: https://dash.cloudflare.com/
- Workers æ–‡æ¡£: https://developers.cloudflare.com/workers/
- Pages æ–‡æ¡£: https://developers.cloudflare.com/pages/
- D1 æ–‡æ¡£: https://developers.cloudflare.com/d1/

---

**ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ¯ä¸€æ­¥æ˜¯å¦æŒ‰ç…§æŒ‡å—æ“ä½œï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“ ID å’Œ API URL çš„é…ç½®ã€‚
